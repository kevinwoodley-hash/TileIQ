<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TileIQ Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">

<!-- LOADING -->
<div id="screen-loading" class="screen">
    <div class="loading-center">
        <div class="logo-mark">‚¨õ</div>
        <div class="logo-text">TileIQ Pro</div>
        <div class="loading-bar"><div class="loading-fill"></div></div>
    </div>
</div>

<!-- DASHBOARD -->
<div id="screen-dashboard" class="screen hidden">
    <header class="app-header">
        <div class="header-brand">
            <span class="brand-icon">‚¨õ</span>
            <span class="brand-name">TileIQ Pro</span>
        </div>
        <div class="header-actions">
            <button onclick="goSettings()" class="btn-icon">‚öô</button>
            <button onclick="goNewJob()" class="btn-primary">+ New Job</button>
        </div>
    </header>
    <div class="page-body">
        <div class="page-title-row">
            <h2 class="page-title">Jobs</h2>
            <span id="job-count" class="badge">0</span>
        </div>
        <div id="jobs-list"></div>
        <div id="jobs-empty" class="empty-state hidden">
            <div class="empty-icon">üìã</div>
            <p>No jobs yet ‚Äî tap + New Job to start.</p>
        </div>
    </div>
</div>

<!-- NEW JOB -->
<div id="screen-new-job" class="screen hidden">
    <header class="app-header">
        <button onclick="goDashboard()" class="btn-back">‚Üê Back</button>
        <h2 class="header-title">New Job</h2>
        <div></div>
    </header>
    <div class="page-body">
        <div class="form-card">
            <div class="form-section-label">Customer Details</div>
            <div class="field-group">
                <label>Customer Name *</label>
                <input id="nj-name" placeholder="Full name">
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label>Phone</label>
                    <input id="nj-phone" type="tel" placeholder="07xxx xxxxxx">
                </div>
                <div class="field-group">
                    <label>Email</label>
                    <input id="nj-email" type="email" placeholder="name@email.com">
                </div>
            </div>
            <div class="field-group">
                <label>Address</label>
                <input id="nj-address" placeholder="Street address">
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label>Town / City</label>
                    <input id="nj-city">
                </div>
                <div class="field-group">
                    <label>Postcode</label>
                    <input id="nj-postcode">
                </div>
            </div>

            <div class="form-section-label" style="margin-top:18px;">Job Details</div>
            <div class="field-group">
                <label>Job Description (optional)</label>
                <input id="nj-desc" placeholder="e.g. Kitchen floor + bathroom walls">
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label>Status</label>
                    <select id="nj-status">
                        <option value="enquiry">Enquiry</option>
                        <option value="quoted">Quoted</option>
                        <option value="accepted">Accepted</option>
                        <option value="complete">Complete</option>
                    </select>
                </div>
                <div class="field-group">
                    <label>Tile Supply</label>
                    <select id="nj-supply">
                        <option value="contractor">We supply tiles</option>
                        <option value="customer">Customer supplies</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button onclick="goDashboard()" class="btn-secondary">Cancel</button>
                <button onclick="createJob()" class="btn-primary">Next: Add Rooms ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<!-- JOB VIEW -->
<div id="screen-job" class="screen hidden">
    <header class="app-header">
        <button onclick="goDashboard()" class="btn-back">‚Üê Jobs</button>
        <h2 id="job-header-title" class="header-title"></h2>
        <button onclick="goAddRoom()" class="btn-primary">+ Room</button>
    </header>
    <div class="page-body">
        <div id="job-customer-bar" class="customer-bar"></div>
        <div class="section-heading-row">
            <span class="form-section-label" style="margin:0;">Rooms</span>
        </div>
        <div id="job-rooms-list"></div>
        <div id="job-rooms-empty" class="empty-state-small">
            Tap <strong>+ Room</strong> above to add your first room.
        </div>
        <div id="job-running-total" class="running-total hidden"></div>
        <div class="job-actions">
            <button onclick="goEditJob()" class="btn-secondary">‚úè Edit Details</button>
            <button onclick="goMaterials()" class="btn-secondary">üì¶ Materials</button>
            <button onclick="goQuote()" class="btn-primary">Quote ‚Üí</button>
        </div>
        <button onclick="deleteJob()" class="btn-danger">üóë Delete Job</button>
    </div>
</div>

<!-- MATERIALS BREAKDOWN -->
<div id="screen-materials" class="screen hidden">
    <header class="app-header">
        <button onclick="goJob()" class="btn-back">‚Üê Back</button>
        <h2 class="header-title">Materials</h2>
        <div></div>
    </header>
    <div class="page-body">
        <div id="materials-output"></div>
    </div>
</div>

<!-- EDIT JOB -->
<div id="screen-edit-job" class="screen hidden">
    <header class="app-header">
        <button onclick="goJob()" class="btn-back">‚Üê Back</button>
        <h2 class="header-title">Edit Job</h2>
        <div></div>
    </header>
    <div class="page-body">
        <div class="form-card">
            <div class="form-section-label">Customer Details</div>
            <div class="field-group">
                <label>Customer Name *</label>
                <input id="ej-name">
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label>Phone</label>
                    <input id="ej-phone" type="tel">
                </div>
                <div class="field-group">
                    <label>Email</label>
                    <input id="ej-email" type="email">
                </div>
            </div>
            <div class="field-group">
                <label>Address</label>
                <input id="ej-address">
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label>Town / City</label>
                    <input id="ej-city">
                </div>
                <div class="field-group">
                    <label>Postcode</label>
                    <input id="ej-postcode">
                </div>
            </div>
            <div class="form-section-label" style="margin-top:18px;">Job Details</div>
            <div class="field-group">
                <label>Job Description</label>
                <input id="ej-desc">
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label>Status</label>
                    <select id="ej-status">
                        <option value="enquiry">Enquiry</option>
                        <option value="quoted">Quoted</option>
                        <option value="accepted">Accepted</option>
                        <option value="complete">Complete</option>
                    </select>
                </div>
                <div class="field-group">
                    <label>Tile Supply</label>
                    <select id="ej-supply">
                        <option value="contractor">We supply tiles</option>
                        <option value="customer">Customer supplies</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button onclick="goJob()" class="btn-secondary">Cancel</button>
                <button onclick="saveEditJob()" class="btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<!-- ROOM EDITOR -->
<div id="screen-room" class="screen hidden">
    <header class="app-header">
        <button onclick="goJob()" class="btn-back">‚Üê Rooms</button>
        <h2 id="room-screen-title" class="header-title">Add Room</h2>
        <div></div>
    </header>
    <div class="page-body">

        <div class="form-card" style="margin-bottom:14px;">
            <div class="field-group" style="margin-bottom:10px;">
                <label>Room Name *</label>
                <input id="rm-name" placeholder="e.g. Main Bathroom">
            </div>
            <label class="checkbox-label" style="margin-bottom:12px;">
                <input type="checkbox" id="rm-customer-tiles" onchange="rmCalc()">
                Customer supplies tiles (no tile cost)
            </label>
            <div class="field-group" style="margin-bottom:0;">
                <label>Labour Pricing</label>
                <div class="labour-toggle">
                    <button id="ltbtn-m2"  onclick="setLabourType('m2')"  class="ltbtn ltbtn-active">¬£/m¬≤</button>
                    <button id="ltbtn-day" onclick="setLabourType('day')" class="ltbtn">Day Rate</button>
                </div>
            </div>
            <div id="labour-day-opts" class="hidden" style="margin-top:10px;">
                <div class="field-row" style="margin-bottom:0;">
                    <div class="field-group" style="margin-bottom:0;">
                        <label>Days</label>
                        <input id="rm-days" type="number" step="0.5" min="0.5" placeholder="e.g. 2" oninput="rmCalc()">
                    </div>
                    <div class="field-group" style="margin-bottom:0;">
                        <label>Day Rate (¬£)</label>
                        <input id="rm-dayrate" type="number" step="10" oninput="rmCalc()">
                    </div>
                </div>
            </div>
        </div>

        <div class="form-section-label" style="margin-bottom:10px;">What are you tiling?</div>
        <div class="stype-row">
            <button id="stype-btn-room"  onclick="rmSelectType('room')"  class="stype-btn stype-room">üè†<br><span>Full Room</span></button>
            <button id="stype-btn-floor" onclick="rmSelectType('floor')" class="stype-btn">‚¨ú<br><span>Floor only</span></button>
            <button id="stype-btn-wall"  onclick="rmSelectType('wall')"  class="stype-btn">üß±<br><span>Wall only</span></button>
        </div>

        <!-- FULL ROOM -->
        <div id="rm-form-room" class="measure-form">
            <div class="form-section-label">Room Measurements</div>
            <div class="field-row">
                <div class="field-group">
                    <label>Length (m)</label>
                    <input id="rm-r-length" type="number" step="0.01" placeholder="e.g. 3.5" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Width (m)</label>
                    <input id="rm-r-width" type="number" step="0.01" placeholder="e.g. 2.2" oninput="rmCalc()">
                </div>
            </div>
            <div class="field-group">
                <label>Wall Height (m)</label>
                <input id="rm-r-height" type="number" step="0.01" placeholder="e.g. 2.4" oninput="rmCalc()">
            </div>
            <div class="field-group">
                <label>Deductions ‚Äì doors / windows (m¬≤)</label>
                <input id="rm-r-deduct" type="number" step="0.01" value="0" oninput="rmCalc()">
            </div>
            <div class="divider-label">Wall Tiles</div>
            <div class="field-row">
                <div class="field-group">
                    <label>Tile W (mm)</label>
                    <input id="rm-r-wtilew" type="number" value="300" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Tile H (mm)</label>
                    <input id="rm-r-wtileh" type="number" value="600" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Tile Thickness (mm)</label>
                    <input id="rm-r-wtilethick" type="number" value="8" oninput="rmCalc()">
                </div>
            </div>
            <div class="field-group">
                <label>Wall Grout Joint (mm)</label>
                <input id="rm-r-wgrout" type="number" value="2" oninput="rmCalc()">
            </div>
            <div class="divider-label">Floor</div>
            <label class="checkbox-label" style="margin-bottom:10px;">
                <input type="checkbox" id="rm-r-inclfloor" checked onchange="rmToggleFloor()">
                Include floor
            </label>
            <div id="rm-r-floor-opts">
                <div class="field-row">
                    <div class="field-group">
                        <label>Floor Tile W (mm)</label>
                        <input id="rm-r-ftilew" type="number" value="600" oninput="rmCalc()">
                    </div>
                    <div class="field-group">
                        <label>Floor Tile H (mm)</label>
                        <input id="rm-r-ftileh" type="number" value="600" oninput="rmCalc()">
                    </div>
                    <div class="field-group">
                        <label>Tile Thickness (mm)</label>
                        <input id="rm-r-ftilethick" type="number" value="10" oninput="rmCalc()">
                    </div>
                </div>
                <div class="field-group">
                    <label>Floor Grout Joint (mm)</label>
                    <input id="rm-r-fgrout" type="number" value="2" oninput="rmCalc()">
                </div>
                <label class="checkbox-label">
                    <input type="checkbox" id="rm-r-ufh" onchange="rmCalc()">
                    Underfloor Heating (UFH)
                </label>
                <div class="divider-label">Floor Preparation</div>
                <div class="prep-options">
                    <label class="prep-option">
                        <input type="checkbox" id="rm-r-cementboard" onchange="rmCalc()">
                        <div class="prep-text"><span>Cement Board</span><span class="prep-cost">+¬£<span class="pc-cb"></span>/m¬≤</span></div>
                    </label>
                    <label class="prep-option">
                        <input type="checkbox" id="rm-r-membrane" onchange="rmCalc()">
                        <div class="prep-text"><span>Anti-Crack Membrane</span><span class="prep-cost">+¬£<span class="pc-mem"></span>/m¬≤</span></div>
                    </label>
                    <label class="prep-option">
                        <input type="checkbox" id="rm-r-levelling" onchange="rmToggleLevelR()">
                        <div class="prep-text"><span>Levelling Compound</span><span class="prep-cost">+¬£<span class="pc-lev-r"></span>/m¬≤</span></div>
                    </label>
                    <div id="rm-r-level-depth" class="prep-depth hidden">
                        <label>Depth</label>
                        <select id="rm-r-leveldepth" onchange="rmCalc()">
                            <option value="2">2 mm</option>
                            <option value="3">3 mm</option>
                            <option value="4">4 mm</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- WALL PREP for full room -->
        <div class="measure-form" id="rm-r-wallprep-card" style="margin-top:-6px;padding-top:12px;">
            <div class="divider-label" style="margin-top:0;">Wall Preparation</div>
            <div class="prep-options">
                <label class="prep-option">
                    <input type="checkbox" id="rm-r-tanking" onchange="rmCalc()">
                    <div class="prep-text"><span>Tanking (Waterproofing)</span><span class="prep-cost">+¬£<span class="pc-tank-r"></span>/m¬≤</span></div>
                </label>
            </div>
        </div>

        <!-- FLOOR ONLY -->
        <div id="rm-form-floor" class="measure-form hidden">
            <div class="form-section-label">Floor Measurements</div>
            <div class="field-row">
                <div class="field-group">
                    <label>Length (m)</label>
                    <input id="rm-f-length" type="number" step="0.01" placeholder="e.g. 3.5" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Width (m)</label>
                    <input id="rm-f-width" type="number" step="0.01" placeholder="e.g. 2.2" oninput="rmCalc()">
                </div>
            </div>
            <div class="divider-label">Tile</div>
            <div class="field-row">
                <div class="field-group">
                    <label>Tile W (mm)</label>
                    <input id="rm-f-tilew" type="number" value="600" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Tile H (mm)</label>
                    <input id="rm-f-tileh" type="number" value="600" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Tile Thickness (mm)</label>
                    <input id="rm-f-tilethick" type="number" value="10" oninput="rmCalc()">
                </div>
            </div>
            <div class="field-group">
                <label>Grout Joint (mm)</label>
                <input id="rm-f-grout" type="number" value="2" oninput="rmCalc()">
            </div>
            <label class="checkbox-label" style="margin-bottom:4px;">
                <input type="checkbox" id="rm-f-ufh" onchange="rmCalc()">
                Underfloor Heating (UFH)
            </label>
            <div class="divider-label">Floor Preparation</div>
            <div class="prep-options">
                <label class="prep-option">
                    <input type="checkbox" id="rm-f-cementboard" onchange="rmCalc()">
                    <div class="prep-text"><span>Cement Board</span><span class="prep-cost">+¬£<span class="pc-cb"></span>/m¬≤</span></div>
                </label>
                <label class="prep-option">
                    <input type="checkbox" id="rm-f-membrane" onchange="rmCalc()">
                    <div class="prep-text"><span>Anti-Crack Membrane</span><span class="prep-cost">+¬£<span class="pc-mem"></span>/m¬≤</span></div>
                </label>
                <label class="prep-option">
                    <input type="checkbox" id="rm-f-levelling" onchange="rmToggleLevelF()">
                    <div class="prep-text"><span>Levelling Compound</span><span class="prep-cost">+¬£<span class="pc-lev-f"></span>/m¬≤</span></div>
                </label>
                <div id="rm-f-level-depth" class="prep-depth hidden">
                    <label>Depth</label>
                    <select id="rm-f-leveldepth" onchange="rmCalc()">
                        <option value="2">2 mm</option>
                        <option value="3">3 mm</option>
                        <option value="4">4 mm</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- WALL ONLY -->
        <div id="rm-form-wall" class="measure-form hidden">
            <div class="form-section-label">Wall Measurements</div>
            <div class="field-row">
                <div class="field-group">
                    <label>Width (m)</label>
                    <input id="rm-w-width" type="number" step="0.01" placeholder="e.g. 3.5" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Height (m)</label>
                    <input id="rm-w-height" type="number" step="0.01" placeholder="e.g. 2.4" oninput="rmCalc()">
                </div>
            </div>
            <div class="divider-label">Tile</div>
            <div class="field-row">
                <div class="field-group">
                    <label>Tile W (mm)</label>
                    <input id="rm-w-tilew" type="number" value="300" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Tile H (mm)</label>
                    <input id="rm-w-tileh" type="number" value="600" oninput="rmCalc()">
                </div>
                <div class="field-group">
                    <label>Tile Thickness (mm)</label>
                    <input id="rm-w-tilethick" type="number" value="8" oninput="rmCalc()">
                </div>
            </div>
            <div class="field-group">
                <label>Grout Joint (mm)</label>
                <input id="rm-w-grout" type="number" value="2" oninput="rmCalc()">
            </div>
            <div class="divider-label">Wall Preparation</div>
            <div class="prep-options">
                <label class="prep-option">
                    <input type="checkbox" id="rm-w-tanking" onchange="rmCalc()">
                    <div class="prep-text"><span>Tanking (Waterproofing)</span><span class="prep-cost">+¬£<span class="pc-tank-w"></span>/m¬≤</span></div>
                </label>
            </div>
        </div>

        <div class="live-total-card">
            <div class="live-total-label">Estimated Room Total <span id="rm-area" class="live-total-m2"></span></div>
            <div class="live-total-value">¬£<span id="rm-total">0.00</span></div>
            <div id="rm-breakdown" class="total-breakdown"></div>
        </div>

        <div class="form-actions" style="margin-top:14px;">
            <button onclick="goJob()" class="btn-secondary">Cancel</button>
            <button onclick="saveRoom()" class="btn-primary">Save Room</button>
        </div>
    </div>
</div>

<!-- SETTINGS -->
<div id="screen-settings" class="screen hidden">
    <header class="app-header">
        <button onclick="goDashboard()" class="btn-back">‚Üê Back</button>
        <h2 class="header-title">Settings</h2>
        <div></div>
    </header>
    <div class="page-body">
        <div class="form-card">
            <div class="form-section-label">Material Costs</div>
            <div class="field-row">
                <div class="field-group"><label>Tile Price (¬£/m¬≤)</label><input id="set-tile-price" type="number" step="0.01"></div>
                <div class="field-group"><label>Grout (per kg) ¬£</label><input id="set-grout-price" type="number" step="0.01"></div>
            </div>
            <div class="field-row">
                <div class="field-group"><label>Adhesive (per bag) ¬£</label><input id="set-adhesive-price" type="number" step="0.01"></div>
                <div class="field-group"><label>Silicone (per tube) ¬£</label><input id="set-silicone-price" type="number" step="0.01"></div>
            </div>
            <div class="form-section-label" style="margin-top:18px;">Pricing</div>
            <div class="field-row">
                <div class="field-group"><label>Material Markup (%)</label><input id="set-markup" type="number"></div>
                <div class="field-group"><label>Markup Labour too?</label>
                    <select id="set-labour-markup"><option value="false">No</option><option value="true">Yes</option></select>
                </div>
            </div>
            <div class="field-row">
                <div class="field-group"><label>Labour Rate (¬£/m¬≤)</label><input id="set-labour-m2" type="number" step="0.5"></div>
                <div class="field-group"><label>Day Rate (¬£/day)</label><input id="set-day-rate" type="number"></div>
            </div>
            <div class="form-section-label" style="margin-top:18px;">Preparation Costs (¬£/m¬≤)</div>
            <div class="field-row">
                <div class="field-group"><label>Cement Board</label><input id="set-cementboard" type="number" step="0.50"></div>
                <div class="field-group"><label>Anti-Crack Membrane</label><input id="set-membrane" type="number" step="0.50"></div>
            </div>
            <div class="field-row">
                <div class="field-group"><label>Levelling 2mm</label><input id="set-level2" type="number" step="0.50"></div>
                <div class="field-group"><label>Levelling 3mm</label><input id="set-level3" type="number" step="0.50"></div>
            </div>
            <div class="field-row">
                <div class="field-group"><label>Levelling 4mm</label><input id="set-level4" type="number" step="0.50"></div>
                <div class="field-group"><label>Tanking (per m¬≤)</label><input id="set-tanking" type="number" step="0.50"></div>
            </div>
            <div class="form-section-label" style="margin-top:18px;">VAT</div>
            <div class="field-group"><label>Apply VAT by default?</label>
                <select id="set-vat"><option value="true">Yes ‚Äì 20%</option><option value="false">No</option></select>
            </div>
            <div class="form-section-label" style="margin-top:18px;">Your Company</div>
            <div class="field-group"><label>Company Name</label><input id="set-company-name" placeholder="Your Tiling Co."></div>
            <div class="field-row">
                <div class="field-group"><label>Phone</label><input id="set-company-phone"></div>
                <div class="field-group"><label>Email</label><input id="set-company-email"></div>
            </div>
            <div class="field-group"><label>Quote Terms</label>
                <textarea id="set-terms" rows="3" placeholder="e.g. Payment due within 14 days‚Ä¶"></textarea>
            </div>
            <div class="form-actions">
                <button onclick="goDashboard()" class="btn-secondary">Cancel</button>
                <button onclick="saveSettings()" class="btn-primary">Save Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- QUOTE -->
<div id="screen-quote" class="screen hidden">
    <header class="app-header">
        <button onclick="goJob()" class="btn-back">‚Üê Back</button>
        <h2 class="header-title">Quote</h2>
        <div></div>
    </header>
    <div class="page-body">
        <div class="form-card" style="margin-bottom:14px;">
            <div class="field-row">
                <div class="field-group"><label>Apply VAT?</label>
                    <select id="q-vat" onchange="renderQuote()"><option value="true">Yes ‚Äì 20%</option><option value="false">No</option></select>
                </div>
                <div class="field-group"><label>Valid for (days)</label>
                    <input id="q-expiry" type="number" value="30" onchange="renderQuote()">
                </div>
            </div>
        </div>
        <div id="quote-output" class="quote-preview-box"></div>
        <div class="ai-section">
            <div class="form-section-label">AI Description</div>
            <div class="field-row">
                <div class="field-group"><label>Style</label>
                    <select id="ai-style">
                        <option value="professional">Professional</option>
                        <option value="labour">Labour Focused</option>
                        <option value="materials">Materials</option>
                        <option value="fixing">Fixing Method</option>
                        <option value="subfloor">Subfloor Prep</option>
                        <option value="sales">Customer Friendly</option>
                    </select>
                </div>
                <div class="field-group" style="display:flex;align-items:flex-end;">
                    <button onclick="generateAI()" class="btn-primary" style="width:100%">‚ú® Generate</button>
                </div>
            </div>
            <div id="ai-box"></div>
        </div>
        <div class="action-row">
            <button onclick="exportCSV()" class="btn-secondary">üìä CSV</button>
            <button onclick="downloadPDF()" class="btn-primary">üìÑ PDF</button>
        </div>
        <button onclick="exportFreeAgent()" class="btn-secondary" style="width:100%;margin-top:8px;">üîó FreeAgent Export</button>
    </div>
</div>

</div>
<script src="script.js"></script>
</body>
</html>
